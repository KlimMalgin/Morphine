var Morphine=function(a){return a()}(function(){function a(){}function b(a){a&&this.build(a)}function c(a,b){var d=a.shift();return a.length?c(a,b[d]):b[d]}function d(c,d){for(var e=c.split("."),f=this,g=f,h=/^[0-9]$/,i=0;i<e.length&&"undefined"!=typeof f;i++)i==e.length-1?"$"===e[i]?f.push(d):h.test(e[i])?"undefined"==typeof f[e[i]]&&console.error("Элемент %o не существует",e.slice(0,i+1).join(".")):f[e[i]]=d:(h.test(e[i+1])||"$"===e[i+1]?"$"===e[i]?f.push(new a):h.test(e[i])?"undefined"==typeof f[e[i]]&&console.error("Элемент %o не существует",e.slice(0,i+1).join(".")):f[e[i]]="undefined"!=typeof f[e[i]]?f[e[i]]:new a:h.test(e[i])?f[e[i]]="undefined"!=typeof f[e[i]]?f[e[i]]:new b:"$"===e[i]?f.push(new b):f[e[i]]="undefined"!=typeof f[e[i]]?f[e[i]]:new b,f="$"===e[i]?f[f.length-1]:f[e[i]]);return g}function e(c,d){for(var g in d)!d.has(g)||d.isUndefined(g)||d.isNull(g)||(f(d[g].constructor)?c[g]=d[g]:(c&&!c.has(g)&&(d[g].isArray()?c[g]=new a:d[g].isObject()&&(c[g]=new b)),e(c[g],d[g])));return c}function f(a,b){b=b?[b]:[Boolean,String,Number];for(var c=b.length,d=0;c>d;d++)if(b[d]===a||b[d]===a.constructor)return!0;return!1}function g(){var a="";return this.isObject()?a=h(this):this.isArray()&&(a=i(this)),a}function h(a){var b="{",c="}",d=[],e="";for(var g in a)a.has(g)&&(e+='"'+g+'":',a[g].isObject&&a[g].isObject()?e+=h(a[g]):a[g].isArray&&a[g].isArray()||a[g].constructor===Array?e+=i(a[g]):f(a[g])?e+=f(a[g],String)?'"'+a[g]+'"':a[g]:(f(a[g],Object)||f(a[g],Array))&&(e+=JSON.stringify(a[g])),d.push(e),e="");return b+d.join(",")+c}function i(a){var b="[",c="]",d=[],e="";for(var g in a)a.has(g)&&"length"!==g&&(a[g].isObject&&a[g].isObject()?e+=h(a[g]):a[g].isArray&&a[g].isArray()?e+=i(a[g]):f(a[g])?e+=a[g]:(f(a[g],Object)||f(a[g],Array))&&(e+=JSON.stringify(a[g])),d.push(e),e="");return b+d.join(",")+c}function j(a){var b=this;return a.constructor===Object?k(a,b):a.constructor===Array&&l(a,b),b}function k(a,c){var c=c||new b;for(var d in a)a.hasOwnProperty(d)&&(a[d].constructor===Object?c.set(d,k(a[d])):a[d].constructor===Array?c.set(d,l(a[d])):a[d].constructor===String||a[d].constructor===Boolean||a[d].constructor===Number?c.set(d,a[d]):console.error("Конструктор не определен %o %o %o",a,d,a[d]));return c}function l(b,c){for(var c=c||new a,d=b.length,e=0;d>e;e++)b[e].constructor===Object?c.push(k(b[e])):b[e].constructor===Array?c.push(l(b[e])):b[e].constructor===String||b[e].constructor===Boolean||b[e].constructor===Number?c.push(b[e]):console.error("Конструктор не определен %o %o %o",b,e,b[e]);return c}function m(){}return a.prototype=new Array,b.extend=a.extend=function(a){if(a)for(var b in a)this.prototype[b]=a[b]},m.prototype.has=function(a){return this.hasOwnProperty(a)},m.prototype.isUndefined=function(a){return"undefined"==typeof this[a]},m.prototype.isNull=function(a){return null===this[a]},m.prototype.isObject=function(){return this.constructor===b},m.prototype.isArray=function(){return this.constructor===a},m.prototype.get=function(a){var b=a.split(".");return c(b,this)},m.prototype.set=function(a,b){var c=d.bind(this)(a,"undefined"!=typeof b?b:{});return c},m.prototype.add=function(a,b){this[a]=b},m.prototype.remove=function(a){delete this[a]},m.prototype.build=function(a){var b=j.bind(this)(a||{});return b},m.prototype.merge=function(a){return e.bind(this)(this,a)},m.prototype.stringify=function(){return g.bind(this)()},m.prototype.toJSON=function(){return JSON.parse(g.bind(this)())},b.extend(m.prototype),a.extend(m.prototype),b});