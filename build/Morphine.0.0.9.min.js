var Morphine=function(a){return a()}(function(){function a(){this.constructor=a}function b(a){a&&this.build(a)}function c(a,b){var d=a.shift();return a.length?c(a,b[d]):b[d]}function d(c,d){for(var e=c.split("."),f=this,g=f,h=/^[0-9]$/,i=0;i<e.length&&"undefined"!=typeof f;i++)i==e.length-1?"$"===e[i]?f.push(d):h.test(e[i])?"undefined"==typeof f[e[i]]&&console.error("Элемент %o не существует",e.slice(0,i+1).join(".")):f[e[i]]=d:(h.test(e[i+1])||"$"===e[i+1]?"$"===e[i]?f.push(new a):h.test(e[i])?"undefined"==typeof f[e[i]]&&console.error("Элемент %o не существует",e.slice(0,i+1).join(".")):f[e[i]]="undefined"!=typeof f[e[i]]?f[e[i]]:new a:h.test(e[i])?f[e[i]]="undefined"!=typeof f[e[i]]?f[e[i]]:new b:"$"===e[i]?f.push(new b):f[e[i]]="undefined"!=typeof f[e[i]]?f[e[i]]:new b,f="$"===e[i]?f[f.length-1]:f[e[i]]);return g}function e(c,d){for(var g in d)!d.has(g)||d.isUndefined(g)||d.isNull(g)||(f(d[g].constructor)?c[g]=d[g]:(c&&!c.has(g)&&(d[g].isArray()?c[g]=new a:d[g].isObject()&&(c[g]=new b)),e(c[g],d[g])));return c}function f(a,b){b=b?[b]:[Boolean,String,Number];for(var c=b.length,d=0;c>d;d++)if(b[d]===a||b[d]===a.constructor)return!0;return!1}function g(){var a="";return this.isObject()?a=h(this):this.isArray()&&(a=i(this)),a}function h(a){var b="{",c="}",d=[],e="";for(var g in a)a.has(g)&&(e+='"'+g+'":',a[g].isObject&&a[g].isObject()?e+=h(a[g]):a[g].isArray&&a[g].isArray()||a[g].constructor===Array?e+=i(a[g]):f(a[g])?e+=f(a[g],String)?'"'+a[g]+'"':a[g]:(f(a[g],Object)||f(a[g],Array))&&(e+=JSON.stringify(a[g])),d.push(e),e="");return b+d.join(",")+c}function i(a){for(var b="[",c="]",d=[],e="",g=a.length,j=0;g>j;j++)a.has(j)&&"length"!==j&&(a[j].isObject&&a[j].isObject()?e+=h(a[j]):a[j].isArray&&a[j].isArray()?e+=i(a[j]):f(a[j])?e+=a[j]:(f(a[j],Object)||f(a[j],Array))&&(e+=JSON.stringify(a[j])),d.push(e),e="");return b+d.join(",")+c}function j(a){var b=this;return a.constructor===Object?k(a,b):a.constructor===Array&&l(a,b),b}function k(a,c){var c=c||new b;for(var d in a)a.hasOwnProperty(d)&&(a[d].constructor===Object?c.set(d,k(a[d])):a[d].constructor===Array?c.set(d,l(a[d])):a[d].constructor===String||a[d].constructor===Boolean||a[d].constructor===Number?c.set(d,a[d]):console.error("Конструктор не определен %o %o %o",a,d,a[d]));return c}function l(b,c){for(var c=c||new a,d=b.length,e=0;d>e;e++)b[e].constructor===Object?c.push(k(b[e])):b[e].constructor===Array?c.push(l(b[e])):b[e].constructor===String||b[e].constructor===Boolean||b[e].constructor===Number?c.push(b[e]):console.error("Конструктор не определен %o %o %o",b,e,b[e]);return c}function m(){var a=[];return this.isObject()?n(this,""):this.isArray()&&o(this,""),a}function n(a,b){var c="";if(f(a));else if(a.isEmpty());else for(var d in a)a.isObject&&a.isObject()?c=n(a[d],b+"."+d):a.isArray&&a.isArray()&&(c=o(a[d],b+"."+d));return c}function o(a,b){var c="";if(f(a));else if(a.isEmpty());else for(var d in a)a.isObject&&a.isObject()?c=n(a[d],b+"."+d):a.isArray&&a.isArray()&&(c=o(a[d],b+"."+d));return c}function p(){}return a.prototype=new Array,a.prototype=new a,b.extend=a.extend=function(a){if(a)for(var b in a)this.prototype[b]=a[b]},p.prototype.create=function(a){return a&&this.build(a),this},p.prototype.has=function(a){return this.hasOwnProperty(a)},p.prototype.isEmpty=function(){for(var a in this)if(this.has(a))return!1;return!0},p.prototype.isUndefined=function(a){return"undefined"==typeof this[a]},p.prototype.isNull=function(a){return null===this[a]},p.prototype.isObject=function(){return this.constructor===b},p.prototype.isArray=function(){return this.constructor===a},p.prototype.get=function(a){var b=a.split(".");return c(b,this)},p.prototype.set=function(c,e){var g="undefined"!=typeof e?e:{},h=f(g),i=null;return h||(f(g,Object)?i=new b:f(g,Array)?i=new a:(f(g,b)||f(g,a))&&(h=!0)),d.bind(this)(c,h?g:j.bind(i)(g)),this},p.prototype.add=function(a,b){this[a]=b},p.prototype.remove=function(a){delete this[a]},p.prototype.build=function(a){return j.bind(this)(a||{}),this},p.prototype.merge=function(a){return e.bind(this)(this,a)},p.prototype.stringify=function(){return g.bind(this)()},p.prototype.toJSON=function(){return JSON.parse(g.bind(this)())},p.prototype.toPaths=function(){return m.bind(this)()},b.extend(p.prototype),a.extend(p.prototype),b});